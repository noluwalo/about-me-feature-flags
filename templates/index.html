<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About Me - Feature Flags Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script type="text/javascript">
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="PLACEHOLDER";analytics.SNIPPET_VERSION="4.15.3";
      }}();
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.5s ease, color 0.5s ease;
            min-height: 100vh;
            overflow-x: hidden;
        }
        body.professional-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e4e4e4;
        }
        body.fun-mode {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 50%, #fab1a0 100%);
            color: #2d3436;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .welcome-screen {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; min-height: 100vh; text-align: center; padding: 20px;
        }
        .welcome-screen h1 { font-size: 3rem; margin-bottom: 20px; }
        .welcome-screen p { font-size: 1.3rem; margin-bottom: 40px; opacity: 0.8; }
        .role-selection { display: flex; gap: 30px; margin: 40px 0; flex-wrap: wrap; justify-content: center; }
        .role-card {
            background: rgba(255, 255, 255, 0.1); border: 2px solid transparent;
            border-radius: 16px; padding: 40px 30px; cursor: pointer;
            transition: all 0.3s; backdrop-filter: blur(10px); width: 250px;
        }
        .role-card:hover { transform: translateY(-10px); border-color: #667eea; box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3); }
        .role-card.selected { border-color: #667eea; background: rgba(102, 126, 234, 0.2); }
        .role-icon { font-size: 4rem; margin-bottom: 20px; }
        .role-card h3 { font-size: 1.5rem; margin-bottom: 10px; }
        .role-card p { font-size: 0.9rem; opacity: 0.7; }
        .name-input-section { margin: 30px 0; }
        .name-input {
            font-size: 1.2rem; padding: 15px 25px; border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px; background: rgba(255, 255, 255, 0.1); color: inherit;
            width: 100%; max-width: 400px; text-align: center; transition: all 0.3s;
        }
        .name-input:focus { outline: none; border-color: #667eea; background: rgba(255, 255, 255, 0.15); }
        .enter-button {
            font-size: 1.3rem; padding: 15px 50px; border: none; border-radius: 50px;
            cursor: pointer; font-weight: 700; transition: all 0.3s; margin-top: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
        }
        .enter-button:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4); }
        .enter-button:disabled { opacity: 0.3; cursor: not-allowed; transform: none; background: #555; }
        .main-content { display: none; }
        .main-content.visible { display: block; }
        .user-info-dropdown {
            position: fixed; top: 20px; left: 20px; z-index: 900;
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px);
            border-radius: 12px; padding: 15px 20px; color: white;
            cursor: pointer; transition: all 0.3s; border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .user-info-dropdown:hover { background: rgba(0, 0, 0, 0.9); border-color: #667eea; }
        .user-info-header { display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .user-dropdown-menu {
            margin-top: 15px; padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2); display: none;
        }
        .user-info-dropdown.expanded .user-dropdown-menu { display: block; }
        .dropdown-option {
            padding: 10px 15px; margin: 5px 0; border-radius: 8px;
            transition: all 0.2s; cursor: pointer; display: flex; align-items: center; gap: 10px;
        }
        .dropdown-option:hover { background: rgba(102, 126, 234, 0.3); }
        .dropdown-option.active { background: rgba(102, 126, 234, 0.5); }
        .segment-tracker {
            position: fixed; top: 20px; right: 20px; background: rgba(52, 152, 219, 0.95);
            color: white; padding: 15px 20px; border-radius: 12px;
            font-family: 'Courier New', monospace; font-size: 0.85rem;
            max-width: 400px; z-index: 1000; border: 2px solid #2980b9;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3); display: none;
        }
        .segment-tracker.visible { display: block; animation: slideInRight 0.3s; }
        @keyframes slideInRight {
            from { transform: translateX(450px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .segment-tracker-header { font-weight: bold; color: #ecf0f1; margin-bottom: 10px; }
        .segment-tracker-code {
            background: rgba(0, 0, 0, 0.3); padding: 12px; border-radius: 6px;
            line-height: 1.6; white-space: pre-wrap; word-break: break-all;
        }
        header { text-align: center; padding: 40px 20px; margin-bottom: 30px; margin-top: 60px; }
        .name-display { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
        .name-display canvas {
            image-rendering: pixelated; image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges; width: 800px; height: 200px;
        }
        @media (max-width: 900px) { .name-display canvas { width: 90vw; height: auto; } }
        .tagline { font-size: 1.1rem; opacity: 0.8; margin-top: 10px; }
        .mode-toggle-container {
            display: flex; justify-content: center; align-items: center;
            gap: 15px; margin: 30px 0; padding: 20px;
            background: rgba(255, 255, 255, 0.1); border-radius: 12px;
        }
        .toggle-switch {
            position: relative; width: 60px; height: 30px;
            background: #ccc; border-radius: 15px; cursor: pointer; transition: background 0.3s;
        }
        .toggle-switch.active { background: #ff6b6b; }
        .toggle-slider {
            position: absolute; top: 3px; left: 3px; width: 24px; height: 24px;
            background: white; border-radius: 50%; transition: transform 0.3s;
        }
        .toggle-switch.active .toggle-slider { transform: translateX(30px); }
        .card {
            padding: 30px; border-radius: 12px;
            transition: transform 0.3s; margin: 20px 0;
        }
        .professional-mode .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .fun-mode .card {
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid #ff6b6b;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); }
        .skill-card { position: relative; overflow: hidden; }
        .skill-card::before {
            content: ''; position: absolute; top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg); transition: all 0.6s;
        }
        .skill-card:hover::before { left: 100%; }
        .skill-card:hover { transform: translateY(-10px) rotate(1deg); box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4); }
        .card h3 { font-size: 1.3rem; margin-bottom: 15px; }
        .image-panel { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin: 20px 0; }
        .image-box {
            width: 270px; height: 270px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem; transition: all 0.3s;
        }
        .professional-mode .image-box {
            background: rgba(100, 100, 200, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .fun-mode .image-box {
            background: rgba(255, 255, 255, 0.5);
            border: 3px solid #ff6b6b;
        }
        .surprise-section {
            text-align: center; margin: 50px 0;
            padding: 40px; border-radius: 12px;
        }
        .professional-mode .surprise-section {
            background: rgba(255, 107, 107, 0.1);
            border: 2px dashed rgba(255, 107, 107, 0.3);
        }
        .fun-mode .surprise-section {
            background: rgba(255, 255, 255, 0.8);
            border: 3px dashed #e74c3c;
        }
        .surprise-button {
            font-size: 1.3rem; padding: 15px 40px; border: none;
            border-radius: 50px; cursor: pointer; font-weight: 700;
            transition: all 0.3s; margin: 20px 0;
        }
        .professional-mode .surprise-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .fun-mode .surprise-button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .surprise-button:hover { transform: scale(1.05); }
        .surprise-content {
            margin-top: 20px; padding: 20px; border-radius: 8px;
            min-height: 50px; display: none;
        }
        .surprise-content.visible { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .debug-toggle {
            position: fixed; bottom: 20px; right: 20px; background: #333;
            color: #0f0; border: 2px solid #0f0; padding: 10px 15px;
            border-radius: 5px; cursor: pointer; font-family: 'Courier New', monospace; z-index: 999;
        }
        .debug-panel {
            position: fixed; bottom: 70px; right: 20px;
            background: rgba(0, 0, 0, 0.9); color: #0f0; padding: 15px;
            border-radius: 8px; font-family: 'Courier New', monospace;
            font-size: 0.85rem; max-width: 300px; display: none;
            z-index: 1000; border: 1px solid #0f0;
        }
        .debug-panel.visible { display: block; }
        .debug-panel h4 { color: #0ff; margin-bottom: 10px; }
        .debug-item { margin: 5px 0; padding: 5px; }
    </style>
</head>
<body class="professional-mode">
    <div class="welcome-screen" id="welcomeScreen">
        <div class="segment-tracker" id="segmentTrackerWelcome">
            <div class="segment-tracker-header">📊 Segment Event</div>
            <div class="segment-tracker-code" id="segmentTrackerCodeWelcome"></div>
        </div>
        <h1>CHOOSE YOUR PATH</h1>
        <p>Identify yourself to unlock your personalized experience</p>
        <div class="role-selection">
            <div class="role-card" data-role="recruiter">
                <div class="role-icon">💼</div>
                <h3>Recruiter</h3>
                <p>Here to evaluate talent and see professional accomplishments</p>
            </div>
            <div class="role-card" data-role="teammate">
                <div class="role-icon">🤝</div>
                <h3>Teammate</h3>
                <p>Part of the team and want to see the fun side</p>
            </div>
        </div>
        <div class="name-input-section">
            <input type="text" class="name-input" id="userName" placeholder="Enter your name..." />
        </div>
        <button class="enter-button" id="enterButton" disabled>Enter Site ⚡</button>
    </div>
    <div class="main-content" id="mainContent">
        <div class="user-info-dropdown" id="userInfoDropdown">
            <div class="user-info-header">
                <span id="userRoleIcon">💼</span>
                <span id="userDisplayName">Guest</span>
                <span>▼</span>
            </div>
            <div class="user-dropdown-menu">
                <div class="dropdown-option" data-role="recruiter">
                    <span>💼</span><span>Switch to Recruiter</span>
                </div>
                <div class="dropdown-option" data-role="teammate">
                    <span>🤝</span><span>Switch to Teammate</span>
                </div>
            </div>
        </div>
        <div class="segment-tracker" id="segmentTracker">
            <div class="segment-tracker-header">📊 Segment Event</div>
            <div class="segment-tracker-code" id="segmentTrackerCode"></div>
        </div>
        <div class="container">
            <header>
                <div class="name-display" id="nameDisplay">Naoise Oluwalogbon</div>
                <p class="tagline" id="tagline">DevOps Engineer | Feature Flag Enthusiast</p>
            </header>
            <div class="mode-toggle-container">
                <span>Professional</span>
                <div class="toggle-switch" id="modeToggle">
                    <div class="toggle-slider"></div>
                </div>
                <span>Fun 🎉</span>
            </div>
            <div class="card">
                <h3>About Me</h3>
                <p id="aboutText">I'm a DevOps Engineer passionate about building reliable, scalable systems.</p>
            </div>
            <div class="image-panel" id="imagePanel">
                <div class="image-box">💼</div>
                <div class="image-box">🏢</div>
                <div class="image-box">🚀</div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 40px 0;">
                <div class="card skill-card">
                    <h3>Certification</h3>
                    <p>CCNA, CCNP, Cisco DevNet Associate & Specialist, Zscaler Certified Cloud Administrator (PA, IA, ZDX), DevNet Class of 2020</p>
                </div>
                <div class="card skill-card">
                    <h3>Skills</h3>
                    <p>Python, SQL, JavaScript, AWS, flask, Snowflake, BigQuery, Cisco/Segment APIs, Replit, Communication & Storytelling</p>
                </div>
                <div class="card skill-card">
                    <h3>Philosophy</h3>
                    <p>Always Wear the Customers Shoes</p>
                </div>
            </div>
            <div class="surprise-section">
                <h2>Want to know more?</h2>
                <button class="surprise-button" id="surpriseButton">Surprise Me 🎲</button>
                <p style="margin-top: 10px; color: #888; font-size: 0.9em;">Click here for a book recommendation or a fun fact</p>
                <div class="surprise-content" id="surpriseContent"></div>
            </div>
        </div>
        <button class="debug-toggle" id="debugToggle">[Debug]</button>
        <div class="debug-panel" id="debugPanel">
            <h4>🚩 Feature Flags</h4>
            <div class="debug-item">Typewriter: <span id="debugTypewriter">...</span></div>
            <div class="debug-item">Mode: <span id="debugMode">...</span></div>
            <div class="debug-item">Variant: <span id="debugVariant">...</span></div>
            <div class="debug-item">Role: <span id="debugRole">...</span></div>
            <div class="debug-item">Clicks: <span id="debugClicks">0</span></div>
        </div>
    </div>
    <script>
        // ========================================
        // FLASK BACKEND API URL & SEGMENT INITIALIZATION
        // ========================================
        const BACKEND_URL = '';  // Use relative URL for Replit environment

        // Load Segment write key and initialize analytics
        (async function initSegment() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/segment-key`);
                const data = await response.json();
                if (data.writeKey) {
                    analytics.load(data.writeKey);
                    console.log('✅ Segment Analytics initialized with key:', data.writeKey.substring(0, 10) + '...');
                }
            } catch (error) {
                console.error('❌ Failed to load Segment key:', error);
            }
        })();

        const appState = {
            currentMode: 'professional',
            surpriseVariant: 'books',
            surpriseClickCount: 0,
            userContext: { name: '', email: '', role: 'general' },
            typewriterAnimation: false
        };

        const bookRecommendations = [
            "📚 The Sword of Kaigen by M.L. Wang",
            "📚 The Poppy War by R.F. Kuang",
            "📚 Mistborn by Brandon Sanderson",
            "📚 One Hundred Thousand Kingdoms by N.K. Jemisin"
        ];

        const funFacts = [
            "🎯 I have played 374.5 hours of Baldurs Gate 3 ",
            "🌸 I am Half Nigerian and Half Irish",
            "🌸 My favourtive trip this year was to Japan",
            "🚀 I deployed my first feature flag on a Monday at 9:19 PM"
        ];

        let selectedRole = null;

        function showSegmentTracker(type, name, props, isWelcome = false) {
            const id = isWelcome ? 'segmentTrackerWelcome' : 'segmentTracker';
            const codeId = isWelcome ? 'segmentTrackerCodeWelcome' : 'segmentTrackerCode';
            const tracker = document.getElementById(id);
            const code = document.getElementById(codeId);
            let displayCode = '';
            
            // Make REAL Segment analytics calls
            if (type === 'identify') {
                displayCode = `analytics.identify('${name}', ${JSON.stringify(props, null, 2)});`;
                console.log(`👤 Segment Identify: ${name}`, props);
                analytics.identify(name, props);
            } else if (type === 'track') {
                displayCode = `analytics.track('${name}', ${JSON.stringify(props, null, 2)});`;
                console.log(`📊 Segment Event: ${name}`, props);
                analytics.track(name, props);
            } else if (type === 'page') {
                displayCode = `analytics.page('${name}', ${JSON.stringify(props, null, 2)});`;
                console.log(`📄 Segment Page: ${name}`, props);
                analytics.page(name, props);
            }
            
            code.textContent = displayCode;
            tracker.classList.add('visible');
            setTimeout(() => tracker.classList.remove('visible'), 5000);
        }

        document.querySelectorAll('.role-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedRole = this.dataset.role;
                showSegmentTracker('identify', 'anon_user', { role: selectedRole }, true);
                checkButton();
            });
        });

        document.getElementById('userName').addEventListener('input', checkButton);

        function checkButton() {
            const name = document.getElementById('userName').value.trim();
            document.getElementById('enterButton').disabled = !(name && selectedRole);
        }

        // ========================================
        // STEP 1: USER ENTERS SITE
        // Fetch feature flags from Flask backend
        // ========================================
        document.getElementById('enterButton').addEventListener('click', async function() {
            const name = document.getElementById('userName').value.trim();
            if (name && selectedRole) {
                appState.userContext.name = name;
                appState.userContext.role = selectedRole;
                appState.userContext.email = `${name.toLowerCase().replace(/\s+/g, '.')}@example.com`;

                showSegmentTracker('identify', appState.userContext.email, { 
                    name: name,
                    role: selectedRole 
                });

                document.getElementById('welcomeScreen').style.display = 'none';
                document.getElementById('mainContent').classList.add('visible');

                updateUserDisplay();

                // ========================================
                // FETCH FLAGS FROM FLASK BACKEND
                // ========================================
                await fetchFeatureFlags();
            }
        });

        // ========================================
        // STEP 2: FETCH FEATURE FLAGS FROM BACKEND
        // This calls your Flask app.py /api/feature-flags endpoint
        // ========================================
        async function fetchFeatureFlags() {
            try {
                console.log('🚀 Fetching feature flags from Flask backend...');

                const response = await fetch(`${BACKEND_URL}/api/feature-flags`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: appState.userContext.email,
                        name: appState.userContext.name,
                        role: appState.userContext.role,
                        location: 'Watford, England, GB',
                        interest: 'devops'
                    })
                });

                const flags = await response.json();
                console.log('✅ Received flags from LaunchDarkly:', flags);

                // ========================================
                // STEP 3: APPLY FLAGS TO APP STATE
                // ========================================
                appState.typewriterAnimation = flags.typewriter_animation;
                appState.currentMode = flags.mode_toggle;
                appState.surpriseVariant = flags.surprise_variant;

                // Update debug panel
                updateDebugPanel('typewriter', appState.typewriterAnimation);
                updateDebugPanel('mode', appState.currentMode);
                updateDebugPanel('variant', appState.surpriseVariant);

                // Show/hide debug panel based on show_debug_panel flag
                if (flags.show_debug_panel) {
                    document.getElementById('debugPanel').classList.add('visible');
                    console.log('🐛 Debug panel auto-enabled by LaunchDarkly flag');
                }

                // ========================================
                // STEP 4: APPLY FEATURES BASED ON FLAGS
                // ========================================
                applyMode(appState.currentMode);

                showSegmentTracker('page', 'About Me', { 
                    role: appState.userContext.role,
                    variant: appState.surpriseVariant,
                    typewriter_enabled: appState.typewriterAnimation
                });

            } catch (error) {
                console.error('❌ Error fetching feature flags:', error);
                console.log('⚠️ Using fallback defaults');
                // Fallback to defaults if backend is unavailable
                appState.currentMode = 'professional';
                appState.typewriterAnimation = false;
                applyMode('professional');
            }
        }

        function updateUserDisplay() {
            const icons = { 'recruiter': '💼', 'teammate': '🤝' };
            document.getElementById('userRoleIcon').textContent = icons[appState.userContext.role];
            document.getElementById('userDisplayName').textContent = appState.userContext.name;
            updateDebugPanel('role', appState.userContext.role);
        }

        document.getElementById('userInfoDropdown').addEventListener('click', function() {
            this.classList.toggle('expanded');
        });

        document.querySelectorAll('.dropdown-option').forEach(option => {
            option.addEventListener('click', async function(e) {
                e.stopPropagation();
                const newRole = this.dataset.role;
                const oldRole = appState.userContext.role;

                if (newRole !== oldRole) {
                    appState.userContext.role = newRole;
                    showSegmentTracker('track', 'User Role Changed', {
                        from_role: oldRole,
                        to_role: newRole,
                        user_name: appState.userContext.name
                    });
                    updateUserDisplay();

                    // Re-fetch flags with new role
                    await fetchFeatureFlags();
                }
                document.getElementById('userInfoDropdown').classList.remove('expanded');
            });
        });

        // ========================================
        // APPLY MODE BASED ON FLAG VALUE
        // ========================================
        function applyMode(mode) {
            appState.currentMode = mode;
            document.body.className = mode + '-mode';
            document.getElementById('modeToggle').classList.toggle('active', mode === 'fun');

            if (mode === 'fun') {
                // Fun mode styling
                document.getElementById('imagePanel').innerHTML = '<div class="image-box">🥊</div><div class="image-box"><img src="/static/images/hiking.jpg" alt="Hiking" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"></div><div class="image-box"><img src="/static/images/flowers.jpg" alt="Flowers" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"></div><div class="image-box"><img src="/static/images/garden.jpg" alt="Garden" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"></div>';
                document.getElementById('aboutText').textContent = "I'm the oldest of three, a brown belt in kickboxing, and a big reader chasing the dream of 100 books a year (my closest: 81 in 2022). I read a lot of fantasy (recs always welcome) and in my spare time, I'm an aspiring florist and a devoted matcha drinker!";
                document.getElementById('tagline').textContent = "Adventure Seeker | Book Lover | Flower Enthusiast 🌸";
            } else {
                // Professional mode styling
                document.getElementById('imagePanel').innerHTML = '<div class="image-box"><img src="/static/images/trophy.png" alt="Trophy" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"></div><div class="image-box"><img src="/static/images/marketing_event.png" alt="Marketing Event" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"></div><div class="image-box"><img src="/static/images/presentation.png" alt="Presentation" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"></div>';
                document.getElementById('aboutText').textContent = "Like Thanos collecting Infinity Stones, I've built an exciting SE career across multiple sectors, from networking at Cisco, to security at Zscaler, to data at Twilio Segment. I've gained extensive experience, earned certifications, led countless whiteboards and demos, and have been a trusted advisor to SMB, commercial, and enterprise customers alike!";
                document.getElementById('tagline').textContent = "Senior SE | EMEA SE Q4 FY24 | Demo Excellence Award | 4 Deals Recognized at Company All Hands |";
            }

            // ========================================
            // TYPEWRITER FLAG CONTROLS ANIMATION IN BOTH MODES
            // Flag ON (true) → Animated typewriter in any mode
            // Flag OFF (false) → Static text in any mode
            // Controlled by LaunchDarkly toggle, not targeting rules
            // ========================================
            if (appState.typewriterAnimation) {
                console.log('✅ typewriter-animation = TRUE → Animation in', mode, 'mode');
                initTypewriter();
            } else {
                console.log('❌ typewriter-animation = FALSE → Static text in', mode, 'mode');
                document.getElementById('nameDisplay').textContent = 'Naoise Oluwalogbon';
            }

            updateDebugPanel('mode', mode);
        }

        document.getElementById('modeToggle').addEventListener('click', function() {
            const oldMode = appState.currentMode;
            const newMode = oldMode === 'professional' ? 'fun' : 'professional';
            applyMode(newMode);
            showSegmentTracker('track', 'Mode Toggle Clicked', { 
                from_mode: oldMode,
                to_mode: newMode,
                theme: newMode,
                toggle_method: 'manual_button_click',
                user_role: appState.userContext.role
            });
        });

        document.getElementById('surpriseButton').addEventListener('click', function() {
            appState.surpriseClickCount++;
            const content = appState.surpriseVariant === 'books' 
                ? bookRecommendations[Math.floor(Math.random() * bookRecommendations.length)]
                : funFacts[Math.floor(Math.random() * funFacts.length)];

            const elem = document.getElementById('surpriseContent');
            elem.innerHTML = `<p>${content}</p>`;
            elem.classList.add('visible');

            showSegmentTracker('track', 'Surprise Clicked', { 
                variant: appState.surpriseVariant,
                clicks: appState.surpriseClickCount 
            });

            updateDebugPanel('clicks', appState.surpriseClickCount);
        });

        document.getElementById('debugToggle').addEventListener('click', function() {
            document.getElementById('debugPanel').classList.toggle('visible');
        });

        function updateDebugPanel(key, value) {
            const map = { 
                mode: 'debugMode', 
                role: 'debugRole', 
                clicks: 'debugClicks', 
                variant: 'debugVariant',
                typewriter: 'debugTypewriter'
            };
            if (map[key]) document.getElementById(map[key]).textContent = value;
        }

        // ========================================
        // TYPEWRITER ANIMATION (runs when flag = TRUE)
        // ========================================
        function initTypewriter() {
            const nameDisplay = document.getElementById('nameDisplay');
            nameDisplay.innerHTML = '<canvas id="typewriterCanvas"></canvas>';
            const canvas = document.getElementById('typewriterCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = 400;
            canvas.height = 100;
            ctx.imageSmoothingEnabled = false;

            const pixelSize = 2;
            const letterSpacing = 2;
            const startX = 5;
            const startY = 10;

            const N = [[0,1,1,0,0,1,1,0],[1,1,1,0,0,1,1,1],[1,1,1,1,0,1,1,1],[1,1,1,1,0,1,1,1],[1,1,1,1,1,1,1,1],[1,1,0,1,1,1,1,1],[1,1,0,0,1,1,1,1],[1,1,0,0,1,1,1,1],[1,1,0,0,0,1,1,1],[0,1,0,0,0,1,1,0]];
            const A = [[0,0,1,1,1,1,0,0],[0,1,1,1,1,1,1,0],[0,1,1,0,0,1,1,0],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[0,1,0,0,0,0,1,0]];
            const O = [[0,1,1,1,1,1,1,0],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[0,1,1,1,1,1,1,0]];
            const I = [[0,1,1,1,1,1,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,1,1,1,1,1,0]];
            const S = [[0,1,1,1,1,1,1,0],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[0,1,1,1,1,1,0,0],[0,0,0,1,1,1,1,0],[0,0,0,0,0,0,1,1],[0,0,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[0,1,1,1,1,1,1,0]];
            const E = [[0,1,1,1,1,1,1,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,1,1,1,1,0,0],[1,1,1,1,1,1,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[0,1,1,1,1,1,1,0]];
            const L = [[0,1,1,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,1,1],[0,1,1,1,1,1,1,0]];
            const U = [[0,1,1,0,0,1,1,0],[1,1,0,0,0,1,1,1],[1,1,0,0,0,1,1,1],[1,1,0,0,0,1,1,1],[1,1,0,0,0,1,1,1],[1,1,0,0,0,1,1,1],[1,1,0,0,0,1,1,1],[1,1,0,0,0,1,1,1],[1,1,0,0,0,1,1,1],[0,1,1,1,1,1,1,0]];
            const W = [[0,1,1,0,0,0,1,1,0],[1,1,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,1,1],[1,1,0,0,1,0,0,1,1],[1,1,0,0,1,0,0,1,1],[1,1,0,1,0,1,0,1,1],[1,1,0,1,0,1,0,1,1],[1,1,1,0,0,0,1,1,1],[0,1,0,0,0,0,0,1,0]];
            const G = [[0,1,1,1,1,1,1,0],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0],[1,1,0,0,1,1,1,1],[1,1,0,0,1,1,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[0,1,1,1,1,1,1,0]];
            const B = [[0,1,1,1,1,1,0,0],[1,1,0,0,0,1,1,0],[1,1,0,0,0,1,1,0],[1,1,0,0,0,1,1,0],[1,1,1,1,1,1,0,0],[1,1,1,1,1,1,0,0],[1,1,0,0,0,1,1,0],[1,1,0,0,0,1,1,0],[1,1,0,0,0,1,1,0],[0,1,1,1,1,1,0,0]];

            const letterMap = { 'N': N, 'A': A, 'O': O, 'I': I, 'S': S, 'E': E, 'L': L, 'U': U, 'W': W, 'G': G, 'B': B, ' ': { empty: true } };
            const text = 'NAOISE OLUWALOGBON';
            const letters = text.split('').map(char => letterMap[char]);

            const letterPositions = [];
            let xPos = startX;
            letters.forEach((letter) => {
                if (letter.empty) {
                    letterPositions.push({ x: xPos, letter: letter, width: 4 * pixelSize });
                    xPos += 4 * pixelSize;
                } else {
                    letterPositions.push({ x: xPos, letter: letter, width: letter[0].length * pixelSize });
                    xPos += (letter[0].length * pixelSize) + (letterSpacing * pixelSize);
                }
            });

            let currentLetterIndex = 0;
            let typingComplete = false;
            let cursorVisible = true;
            let lastCursorBlink = 0;
            let lastTyping = 0;
            let cursorBlinkCount = 0;
            const typingSpeed = 150;
            const cursorBlinkSpeed = 500;
            const maxBlinks = 5;

            function drawLetter(letter, x) {
                if (letter.empty) return;
                for (let row = 0; row < letter.length; row++) {
                    for (let col = 0; col < letter[row].length; col++) {
                        if (letter[row][col] === 1) {
                            ctx.fillRect(x + col * pixelSize, startY + row * pixelSize, pixelSize, pixelSize);
                        }
                    }
                }
            }

            function drawCursor(x) {
                if (cursorVisible) {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(x, startY, pixelSize, 10 * pixelSize);
                }
            }

            function animate(timestamp) {
                const bgColor = appState.currentMode === 'fun' ? '#ffeaa7' : '#1a1a2e';
                ctx.fillStyle = bgColor;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = appState.currentMode === 'fun' ? '#2d3436' : 'white';
                for (let i = 0; i < currentLetterIndex; i++) {
                    drawLetter(letterPositions[i].letter, letterPositions[i].x);
                }

                if (!typingComplete) {
                    if (timestamp - lastTyping >= typingSpeed) {
                        currentLetterIndex++;
                        lastTyping = timestamp;
                        if (currentLetterIndex >= letters.length) {
                            typingComplete = true;
                        }
                    }
                    if (currentLetterIndex < letters.length) {
                        drawCursor(letterPositions[currentLetterIndex].x);
                    } else {
                        drawCursor(letterPositions[currentLetterIndex - 1].x + letterPositions[currentLetterIndex - 1].width + (letterSpacing * pixelSize));
                    }
                } else {
                    if (timestamp - lastCursorBlink >= cursorBlinkSpeed) {
                        cursorVisible = !cursorVisible;
                        lastCursorBlink = timestamp;
                        if (!cursorVisible) {
                            cursorBlinkCount++;
                        }
                        if (cursorBlinkCount >= maxBlinks) {
                            currentLetterIndex = 0;
                            typingComplete = false;
                            cursorVisible = true;
                            cursorBlinkCount = 0;
                            lastTyping = timestamp;
                            lastCursorBlink = timestamp;
                        }
                    }
                    const lastLetterPos = letterPositions[letterPositions.length - 1];
                    drawCursor(lastLetterPos.x + lastLetterPos.width + (letterSpacing * pixelSize));
                }

                requestAnimationFrame(animate);
            }

            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>